!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("PrismicRichtext",[],e):"object"==typeof exports?exports.PrismicRichtext=e():t.PrismicRichtext=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,n){"use strict";e.__esModule=!0,e.NODE_TYPES={heading1:"heading1",heading2:"heading2",heading3:"heading3",heading4:"heading4",heading5:"heading5",heading6:"heading6",paragraph:"paragraph",preformatted:"preformatted",strong:"strong",em:"em",listItem:"list-item",oListItem:"o-list-item",list:"group-list-item",oList:"group-o-list-item",image:"image",embed:"embed",hyperlink:"hyperlink",label:"label",span:"span"},e.PRIORITIES=(r={},r[e.NODE_TYPES.heading1]=4,r[e.NODE_TYPES.heading2]=4,r[e.NODE_TYPES.heading3]=4,r[e.NODE_TYPES.heading4]=4,r[e.NODE_TYPES.heading5]=4,r[e.NODE_TYPES.heading6]=4,r[e.NODE_TYPES.paragraph]=3,r[e.NODE_TYPES.preformatted]=5,r[e.NODE_TYPES.strong]=6,r[e.NODE_TYPES.em]=6,r[e.NODE_TYPES.oList]=1,r[e.NODE_TYPES.list]=1,r[e.NODE_TYPES.listItem]=1,r[e.NODE_TYPES.oListItem]=1,r[e.NODE_TYPES.image]=1,r[e.NODE_TYPES.embed]=1,r[e.NODE_TYPES.hyperlink]=3,r[e.NODE_TYPES.label]=4,r[e.NODE_TYPES.span]=7,r);var r},function(t,e,n){"use strict";function r(t){return t.sort(function(t,e){if(t.isParentOf(e))return-1;if(e.isParentOf(t))return 1;var n=x.PRIORITIES[t.type]-x.PRIORITIES[e.type];return 0===n?t.text.length-e.text.length:n})}function i(t,e,n){return n.start<e.start?{inner:m.SpanNode.slice(n,e.start,n.end,t),outer:m.SpanNode.slice(n,n.start,e.start,t)}:n.end>e.end?{inner:m.SpanNode.slice(n,n.start,e.end,t),outer:m.SpanNode.slice(n,e.end,n.end,t)}:{inner:n}}function o(t,e){var n=e.others.reduce(function(n,r){var o=n.inner,c=n.outer,u=i(t,e.elected,r);return{inner:o.concat(u.inner),outer:u.outer?c.concat(u.outer):c}},{inner:[],outer:[]}),r=n.inner,o=n.outer;return[e.elected.setChildren(d(t,r,e.elected.boundaries()))].concat(l(t,o))}function c(t,e){return e.reduce(function(e,n){var r=p.last(e);if(r){if(r.some(function(t){return t.isParentOf(n)}))return p.init(e).concat([r.concat(n)]);var i=p.last(r);return i&&t(i,n)?p.init(e).concat([r.concat(n)]):e.concat([[n]])}return[[n]]},[])}function u(t){var e=function(t,e){return t.start-e.start},n=function(t,e){return t.end-e.end},r=p.sortWith([e,n],t);return c(function(t,e){return t.end>=e.start},r)}function s(t){if(0===t.length)throw new Error("Unable to elect node on empty list");var e=r(t);return{elected:e[0],others:e.slice(1)}}function a(t,e,n){return e.reduce(function(r,i,o){var c=[],u=0===o&&i.start>n.lower,s=o===e.length-1&&n.upper>i.end;if(u){var a=new m.TextNode(n.lower,i.start,t.slice(n.lower,i.start));c=c.concat(a)}else{var d=e[o-1];if(d&&i.start>d.end){var l=t.slice(d.end,i.start),a=new m.TextNode(d.end,i.start,l);c=c.concat(a)}}if(c=c.concat(i),s){var a=new m.TextNode(i.end,n.upper,t.slice(i.end,n.upper));c=c.concat(a)}return r.concat(c)},[])}function d(t,e,n){if(e.length>0)return a(t,l(t,e),n);var r=t.slice(n.lower,n.upper);return[new m.TextNode(n.lower,n.upper,r)]}function l(t,e){var n=p.sortBy(function(t){return t.start},e),r=u(n),i=r.map(s),c=p.flatten(i.map(function(e){return o(t,e)}));return p.sortBy(function(t){return t.start},c)}function f(t){var e=t.spans.map(function(e){var n=t.text.slice(e.start,e.end);return new m.SpanNode(e.start,e.end,e.type,n,[],e)}),n={lower:0,upper:t.text.length};return d(t.text,e,n)}e.__esModule=!0;var p=n(7),h=n(2),E=n(8),x=n(0),m=n(3),_=function(){function t(){}return t.fromRichText=function(t){return{key:h.default(),children:t.reduce(function(t,e,n){if(E.RichTextBlock.isEmbedBlock(e.type)||E.RichTextBlock.isImageBlock(e.type))return t.concat(new m.BlockNode(e.type,e));var r=f(e),i=t[t.length-1];if(E.RichTextBlock.isListItem(e.type)&&i&&i instanceof m.ListBlockNode){var o=new m.ListItemBlockNode(e,r),c=i.addChild(o);return p.init(t).concat(c)}if(E.RichTextBlock.isOrderedListItem(e.type)&&i&&i instanceof m.OrderedListBlockNode){var u=new m.OrderedListItemBlockNode(e,r),c=i.addChild(u);return p.init(t).concat(c)}if(E.RichTextBlock.isListItem(e.type)){var o=new m.ListItemBlockNode(e,r),s=new m.ListBlockNode(E.RichTextBlock.emptyList(),[o]);return t.concat(s)}if(E.RichTextBlock.isOrderedListItem(e.type)){var u=new m.OrderedListItemBlockNode(e,r),a=new m.OrderedListBlockNode(E.RichTextBlock.emptyOrderedList(),[u]);return t.concat(a)}return t.concat(new m.BlockNode(e.type,e,r))},[])}},t.NODE_TYPES=x.NODE_TYPES,t}();e.default=_},function(t,e,n){"use strict";function r(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}e.__esModule=!0,e.default=r},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.__esModule=!0;var i=n(2),o=n(0),c=function(){function t(t,e,n){this.key=i.default(),this.type=t,this.element=e,this.children=n}return t}();e.Node=c;var u=function(t){function e(e,n,r,i,o,c){var u=t.call(this,r,c,o)||this;return u.start=e,u.end=n,u.text=i,u.children=o,u}return r(e,t),e.prototype.boundaries=function(){return{lower:this.start,upper:this.end}},e.prototype.isParentOf=function(t){return this.start<=t.start&&this.end>=t.end},e.prototype.setChildren=function(t){return new e(this.start,this.end,this.type,this.text,t,this.element)},e.slice=function(t,n,r,i){return new e(n,r,t.type,i.slice(n,r),t.children,t.element)},e}(c);e.SpanNode=u;var s=function(t){function e(e,n,r){var i={type:o.NODE_TYPES.span,start:e,end:n,text:r};return t.call(this,e,n,o.NODE_TYPES.span,r,[],i)||this}return r(e,t),e}(u);e.TextNode=s;var a=function(t){function e(e,n,r){return void 0===r&&(r=[]),t.call(this,e,n,r)||this}return r(e,t),e}(c);e.BlockNode=a;var d=function(t){function e(e,n){return t.call(this,o.NODE_TYPES.listItem,e,n)||this}return r(e,t),e}(a);e.ListItemBlockNode=d;var l=function(t){function e(e,n){return t.call(this,o.NODE_TYPES.oListItem,e,n)||this}return r(e,t),e}(a);e.OrderedListItemBlockNode=l;var f=function(t){function e(e,n){return t.call(this,o.NODE_TYPES.oList,e,n)||this}return r(e,t),e.prototype.addChild=function(t){var n=this.children.concat(t);return new e(this.element,n)},e}(a);e.OrderedListBlockNode=f;var p=function(t){function e(e,n){return t.call(this,o.NODE_TYPES.list,e,n)||this}return r(e,t),e.prototype.addChild=function(t){var n=this.children.concat(t);return new e(this.element,n)},e}(a);e.ListBlockNode=p},function(t,e,n){t.exports=n(5)},function(t,e,n){"use strict";e.__esModule=!0;var r=n(6),i=n(1),o=n(9);t.exports={asText:r.default,asTree:i.default.fromRichText,serialize:o.default,Elements:i.default.NODE_TYPES}},function(t,e,n){"use strict";function r(t,e){var n="string"==typeof e?e:" ";return t.map(function(t){return t.text}).join(n)}e.__esModule=!0,e.default=r},function(t,e,n){"use strict";function r(t){return t.reduce(function(t,e){return Array.isArray(e)?t.concat(r(e)):t.concat(e)},[])}function i(t){return t[t.length-1]}function o(t){return t.slice(0,-1)}function c(t,e){return t.reduce(function(t,e){return t.sort(e)},e)}function u(t,e){return e.slice().sort(t)}e.__esModule=!0,e.flatten=r,e.last=i,e.init=o,e.sortWith=c,e.sortBy=u},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=function(){function t(t,e,n){this.type=t,this.text=e,this.spans=n}return t.isEmbedBlock=function(t){return t===r.NODE_TYPES.embed},t.isImageBlock=function(t){return t===r.NODE_TYPES.image},t.isList=function(t){return t===r.NODE_TYPES.list},t.isOrderedList=function(t){return t===r.NODE_TYPES.oList},t.isListItem=function(t){return t===r.NODE_TYPES.listItem},t.isOrderedListItem=function(t){return t===r.NODE_TYPES.oListItem},t.emptyList=function(){return{type:r.NODE_TYPES.list,spans:[],text:""}},t.emptyOrderedList=function(){return{type:r.NODE_TYPES.oList,spans:[],text:""}},t}();e.RichTextBlock=i},function(t,e,n){"use strict";function r(t,e,n){return o.default.fromRichText(t).children.map(function(t,r){return i(t,e,r,n)})}function i(t,e,n,r){function i(t,n){var o=t instanceof c.SpanNode?t.text:null,u=t.children.reduce(function(t,e,n){return t.concat([i(e,n)])},[]);return r&&r(t.type,t.element,o,u,n)||e(t.type,t.element,o,u,n)}return i(t,n)}e.__esModule=!0;var o=n(1),c=n(3);e.default=r}])});